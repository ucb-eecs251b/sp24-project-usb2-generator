# USB2.0: UTMI Integration

# Description
The universal serial bus (USB2.0) is a fast, bi-directional interface that enhances PC connectivity with peripherals. The USB 2.0 Transceiver Macrocell Interface (UTMI) is located within the USB 2.0 Transceiver Macrocell (UTM). 

High-level Interface Information: 
+ Phyiscal Layer Interface (PHY) consists of a 56 pin VQFN
+ Supports up to 480 Mbps transfer rate
+ Configured as 8 bit bidirectional interface

UTMI bridges TX \& RX logic, handling:
+ SYNC and EOP generation on transmit packets and detection on receive packets
+ NRZI encoding and decoding
+ Bit stuffing and unstuffing with error detection
+ Clock domain crossings between USB2.0 data rates and general device logic

# Organization
A rough top-level diagram of the chip is shown below: TODO (likely not)

A UTMI block contains the following elements: TODO

To the extent possible, the top level will be generated by Chipyard/Hammer.

## Rocket
- A Rocket instance generated by Chipyard
- Communicates with the UTMI block via memory-mapped I/O

## UTMI Block
This block consists of the following pins:
- `clk`: global clock
- `reset`: global reset signal
- `DP`: data plus / USB positive data pin
- `DM`: data minus / USB negatative data pin

This block consists of the following interface signals: TODO table


There are four modes of operation:
- HS/FS (30MHz)
- HS/FS (60MHz)
- FS only
- LS only

We currently only support 8 bit unidirectional HS/FS.

### Ready / Valid Interface

#### TX Async Queue

#### RX Async Queue

#### Testing
Chisel Testbench

### MMIO Structure
The MMIO controller exposes the following memory-mapped registers.
| Name     | Width | Direction     | Description         | 
| -------- | ----- | ------------- | ------------------- |
| `signal1` | 1   | R/W | descript |
| `signal1` | 8   | R/W | descript |

Widths are specified in bits. For the direction field:

- R/W means the register is readable and writable.
- RO means the register is read-only.
- WO means the register is write-only.

#### Testing
C tests


## Analog FrontEnd
The majority of the analog frontend has yet to be implemented.

### [Implemented] Data Recovery Circuit
+ Recovered dout to RX

### To be Implemented
+ PLL: 480 MHz
+ DLL: 10-phase clock
+ RX \& TX analog logic

## References
1. Intel Specification: TODO insert links
2. Microchip Specification: 